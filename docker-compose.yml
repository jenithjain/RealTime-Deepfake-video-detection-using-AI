# Docker Compose for local development
# Usage: docker-compose up

services:
  # Backend API Service
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: deepfake-backend-dev
    ports:
      - "5000:5000"
    environment:
      - FLASK_ENV=development
      - DEVICE=cpu
      - PYTHONUNBUFFERED=1
      - PORT=5000
    volumes:
      # Mount code for hot reload during development
      - ./backend_server.py:/app/backend_server.py
      - ./deepfake_detection.py:/app/deepfake_detection.py
      - ./face_detection.py:/app/face_detection.py
      # Mount weights directory
      - ./weights:/app/weights
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5000/health', timeout=5)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

networks:
  default:
    name: deepfake-network
